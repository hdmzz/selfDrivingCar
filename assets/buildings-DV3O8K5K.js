var at=Object.defineProperty;var O=i=>{throw TypeError(i)};var dt=(i,t,e)=>t in i?at(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var h=(i,t,e)=>dt(i,typeof t!="symbol"?t+"":t,e),lt=(i,t,e)=>t.has(i)||O("Cannot "+e);var k=(i,t,e)=>t.has(i)?O("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e);var f=(i,t,e)=>(lt(i,t,"access private method"),e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */class l{constructor(t,e){this.x=t,this.y=e}draw(t,{size:e=18,color:s="black",outline:o=!1,fill:n=!1}={}){const r=e/2;t.beginPath(),t.fillStyle=s,t.arc(this.x,this.y,r,0,Math.PI*2),t.fill(),o&&(t.save(),t.beginPath(),t.lineWidth=2,t.strokeStyle="yellow",t.arc(this.x,this.y,r*.6,0,Math.PI*2),t.stroke(),t.restore()),n&&(t.save(),t.beginPath(),t.fillStyle="yellow",t.arc(this.x,this.y,r*.4,0,Math.PI*2),t.fill(),t.restore())}equals(t){return this.x===t.x&&this.y===t.y}}function G(i,t,e=Number.MAX_SAFE_INTEGER){let s=Number.MAX_SAFE_INTEGER,o=null;for(const n of t){const r=b(n,i);r<s&&r<e&&(s=r,o=n)}return o}function ct(i,t){return new l((i.x+t.x)/2,(i.y+t.y)/2)}function b(i,t){return Math.hypot(i.x-t.x,i.y-t.y)}function E(i,t){return new l(i.x*t,i.y*t)}function P(i,t){return new l(i.x+t.x,i.y+t.y)}function M(i,t){return new l(i.x-t.x,i.y-t.y)}function ut(i){return Math.atan2(i.y,i.x)}function F(i,t,e){return new l(i.x+Math.cos(t)*e,i.y+Math.sin(t)*e)}function I(i,t,e,s){const o=(s.x-e.x)*(i.y-e.y)-(s.y-e.y)*(i.x-e.x),n=(e.y-i.y)*(i.x-t.x)-(e.x-i.x)*(i.y-t.y),r=(s.y-e.y)*(t.x-i.x)-(s.x-e.x)*(t.y-i.y);if(Math.abs(r)>.001){const d=o/r,u=n/r;if(d>=0&&d<=1&&u>=0&&u<=1)return{x:z(i.x,t.x,d),y:z(i.y,t.y,d),offset:d}}return null}function z(i,t,e){return i+(t-i)*e}function J(i){return E(i,1/K(i))}function K(i){return Math.hypot(i.x,i.y)}function gt(i,t){return i.x*t.x+i.y*t.y}class v{constructor(t,e){this.p1=t,this.p2=e}draw(t,{width:e=4,color:s="white",dash:o=[0,0]}={}){t.beginPath(),t.strokeStyle=s,t.setLineDash(o),t.moveTo(this.p1.x,this.p1.y),t.lineTo(this.p2.x,this.p2.y),t.stroke(),t.setLineDash([])}distanceToPoint(t){const e=this.projectPoint(t);if(e.offset>0&&e.offset<1)return b(t,e.point);const s=b(t,this.p1),o=b(t,this.p2);return Math.min(s,o)}projectPoint(t){const e=M(t,this.p1),s=M(this.p2,this.p1),o=J(s),n=gt(e,o);return{point:P(this.p1,E(o,n)),offset:n/K(s)}}lenght(){return b(this.p1,this.p2)}equals(t){return this.includes(t.p1)&&this.includes(t.p2)}includes(t){return this.p1.equals(t)||this.p2.equals(t)}directionVector(){return J(M(this.p2,this.p1))}}var p,U,C,D,B,Q;class ft{constructor(t,e){k(this,p);h(this,"ctx");h(this,"selected");h(this,"hovered");h(this,"dragging");h(this,"viewport");h(this,"graph");h(this,"mouse");this.viewport=t,this.graph=e,this.ctx=this.viewport.ctx,this.selected=null,this.hovered=null,this.dragging=!1,f(this,p,U).call(this)}dispose(){this.graph.dispose(),this.selected=null,this.hovered=null}display(){var t;if(this.graph.draw(this.ctx),(t=this.hovered)==null||t.draw(this.ctx,{fill:!0}),this.selected){const e=this.hovered?this.hovered:this.mouse;new v(this.selected,e).draw(this.ctx,{dash:[3,3]}),this.selected.draw(this.ctx,{outline:!0})}}}p=new WeakSet,U=function(){this.viewport.canvas.addEventListener("mousedown",f(this,p,D).bind(this)),this.viewport.canvas.addEventListener("mousemove",f(this,p,C).bind(this)),this.viewport.canvas.addEventListener("mouseup",()=>this.dragging=!1)},C=function(t){this.mouse=this.viewport.getMouse(t),this.hovered=G(this.mouse,this.graph.points,10),this.dragging===!0&&(this.selected.x=this.mouse.x,this.selected.y=this.mouse.y)},D=function(t){if(t.button===2){this.hovered?f(this,p,Q).call(this,this.hovered):this.hovered||(this.selected=null);return}if(t.button===0){if(this.viewport.drag.active===!0)return;if(this.mouse=this.viewport.getMouse(t),this.hovered=G(this.mouse,this.graph.points,10),this.hovered){f(this,p,B).call(this,this.hovered),this.dragging=!0;return}this.graph.addPoint(this.mouse),f(this,p,B).call(this,this.mouse);return}if(this.hovered){this.selected=this.hovered;return}},B=function(t){this.selected&&this.graph.tryAddSegment(this.selected,t),this.selected=t},Q=function(t){this.graph.removePoint(t),this.selected=null,this.hovered=null};class T{constructor(t,e){this.points=t,this.segments=e}draw(t){for(const e of this.points)e.draw(t);for(const e of this.segments)e.draw(t)}hash(){return JSON.stringify(this)}dispose(){this.points.length=0,this.segments.length=0}getSegmentWithPoint(t){const e=[];for(const s of this.segments)s.includes(t)&&e.push(s);return e}addPoint(t){return this.points.push(t),!0}removePoint(t){const e=this.getSegmentWithPoint(t);if(!this.containsPoint(t))return!1;for(const s of e)this.removeSegment(s);return this.points.splice(this.points.indexOf(t),1),!0}containsPoint(t){return this.points.find(e=>e.equals(t))}addSegment(t){return this.segments.push(t),!0}removeSegment(t){return this.segments.splice(this.segments.indexOf(t),1),!0}containsSegment(t){return this.segments.find(e=>e.equals(t))}tryAddSegment(t,e){const s=new v(t,e);return this.containsSegment(s)||t.equals(e)?!1:this.addSegment(s)}tryRemoveSegment(t){return!this.containsSegment(t)||t.p1.equals(t.p2)?!1:this.removeSegment(t)}static load(t){const e=t.points.map(o=>new l(o.x,o.y)),s=t.segments.map(o=>new v(e.find(n=>n.equals(o.p1)),e.find(n=>n.equals(o.p2))));return new T(e,s)}}var w,Z,$,A,tt,et;class pt{constructor(t){k(this,w);h(this,"ctx");h(this,"canvas");h(this,"zoom",1);h(this,"center");h(this,"offset");h(this,"drag");this.canvas=t,this.ctx=t.getContext("2d"),this.center=new l(0,0),this.offset=E(this.center,-1),this.drag={start:new l(0,0),end:new l(0,0),offset:new l(0,0),active:!1},f(this,w,Z).call(this)}reset(){this.ctx.restore(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.center.x,this.center.y),this.ctx.scale(1/this.zoom,1/this.zoom);const t=this.getOffset();this.ctx.translate(t.x,t.y)}getMouse(t,e=!1){const s=new l((t.offsetX-this.center.x)*this.zoom-this.offset.x,(t.offsetY-this.center.y)*this.zoom-this.offset.y);return e?M(s,this.drag.offset):s}getOffset(){return P(this.offset,this.drag.offset)}}w=new WeakSet,Z=function(){this.canvas.addEventListener("mousewheel",f(this,w,$).bind(this)),this.canvas.addEventListener("mousedown",f(this,w,A).bind(this)),this.canvas.addEventListener("mousemove",f(this,w,tt).bind(this)),this.canvas.addEventListener("mouseup",f(this,w,et).bind(this))},$=function(t){t.preventDefault(),t.stopPropagation();const e=Math.sign(t.deltaY),s=.1;this.zoom+=e*s,this.zoom=Math.max(1,Math.min(5,this.zoom))},A=function(t){t.button===0&&t.ctrlKey===!0&&(this.drag.start=this.getMouse(t),this.drag.active=!0)},tt=function(t){this.drag.active&&(this.drag.end=this.getMouse(t),this.drag.offset=M(this.drag.end,this.drag.start))},et=function(t){this.drag.active&&(this.offset=P(this.offset,this.drag.offset),this.drag={start:new l(0,0),end:new l(0,0),offset:new l(0,0),active:!1})};class st{}class mt extends st{constructor(e,s=200){super();h(this,"base");h(this,"points");h(this,"height");this.points=e.points,this.base=e,this.height=s}draw(e){this.base.draw(e)}}class wt extends st{constructor(e,s){super();h(this,"center");h(this,"size");this.center=e,this.size=s}draw(e){this.center.draw(e,{size:this.size,color:"green"});const s=P(this.center,{x:-40,y:-40});new v(this.center,s).draw(e,{color:"white"})}}class x{constructor(t){h(this,"points");h(this,"segments");this.points=t,this.segments=[];for(let e=1;e<=t.length;e++)this.segments.push(new v(t[e-1],this.points[e%t.length]))}distanceToPoint(t){return Math.min(...this.segments.map(e=>e.distanceToPoint(t)))}distanceToPoly(t){return Math.min(...this.points.map(e=>t.distanceToPoint(e)))}intersectsPolygon(t){for(const e of this.segments)for(const s of t.segments)if(I(e.p1,e.p2,s.p1,s.p2))return!0;return!1}static union(t){x.multiBreak(t);const e=[];for(let s=0;s<t.length;s++)for(const o of t[s].segments){let n=!0;for(let r=0;r<t.length;r++)if(s!=r&&t[r].containsSegment(o)){n=!1;break}n&&o!==void 0&&e.push(o)}return e}static multiBreak(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++)x.break(t[e],t[s])}static break(t,e){const s=t.segments,o=e.segments;for(let n=0;n<s.length;n++)for(let r=0;r<o.length;r++){if(!s[n]||!o[r])continue;const g=I(s[n].p1,s[n].p2,o[r].p1,o[r].p2);if(g&&g.offset!=1&&g.offset!=0){const d=new l(g.x,g.y);let u=s[n].p2;s[n].p2=d,s.splice(n+1,0,new v(d,u)),u=o[r].p2,o[r].p2=d,o.splice(r+1,0,new v(d,u))}}}containsSegment(t){if(!t)return!1;const e=ct(t.p1,t.p2);return this.containsPoint(e)}containsPoint(t){const e=new l(-1e3,-1e3);let s=0;for(const o of this.segments){if(!o)continue;I(e,t,o.p1,o.p2)&&s++}return s%2==1}draw(t,{stroke:e="blue",lineWidth:s=2,fill:o="rgba(0, 0, 255, 0.3)"}={}){if(this.points.length!==0){t.beginPath(),t.fillStyle=o,t.strokeStyle=e,t.lineWidth=s,t.moveTo(this.points[0].x,this.points[0].y);for(let n=1;n<this.points.length;n++)t.lineTo(this.points[n].x,this.points[n].y);t.closePath(),t.fill(),t.stroke()}}}var L,it;class q{constructor(t,e,s=1){k(this,L);h(this,"skeleton");h(this,"poly");t!==void 0&&(this.skeleton=t,this.poly=f(this,L,it).call(this,e,s))}draw(t,e={}){var s;((s=this.poly)==null?void 0:s.points.length)===0||this.skeleton===void 0||this.poly.draw(t,e)}}L=new WeakSet,it=function(t,e){const{p1:s,p2:o}=this.skeleton,n=t/2,r=ut(M(s,o)),g=r+Math.PI/2,d=r-Math.PI/2,u=[],a=Math.PI/Math.max(1,e),m=a/2;for(let c=d;c<=g+m;c+=a)u.push(F(s,c,n));for(let c=d;c<=g+m;c+=a)u.push(F(o,Math.PI+c,n));return new x(u)};var S,nt,ot;class vt{constructor(t,e=100,s=10,o=150,n=50,r=150){k(this,S);h(this,"graph");h(this,"roadRoundness");h(this,"roadWidth");h(this,"envelopes");h(this,"buildings");h(this,"roadBoarders");h(this,"trees");h(this,"buildingWidth");h(this,"spacing");h(this,"buildingMinLenght");h(this,"treeSize",160);this.graph=t,this.roadWidth=e,this.roadRoundness=s,this.envelopes=new Array(this.graph.segments.length),this.roadBoarders=[],this.buildingWidth=o,this.spacing=n,this.buildingMinLenght=r,this.generate()}generate(){this.envelopes.length=0;for(const t of this.graph.segments)this.envelopes.push(new q(t,this.roadWidth,this.roadRoundness));this.roadBoarders=x.union(this.envelopes.map(t=>t.poly)),this.buildings=f(this,S,ot).call(this),this.trees=f(this,S,nt).call(this)}draw(t){for(const e of this.envelopes)e.draw(t,{fill:"#BBB",stroke:"#BBB",lineWidth:5});for(const e of this.graph.segments)e.draw(t,{color:"white",width:4,dash:[10,10]});for(const e of this.roadBoarders)e.draw(t,{color:"white",width:4});for(const e of this.buildings)e.draw(t);for(const e of this.trees)e.draw(t)}}S=new WeakSet,nt=function(t=10){const e=[...this.roadBoarders.map(a=>[a.p1,a.p2]).flat(),...this.buildings.map(a=>a.points).flat()],s=[...this.buildings.map(a=>a.base),...this.envelopes.map(a=>a.poly)],o=Math.min(...e.map(a=>a.x)),n=Math.max(...e.map(a=>a.x)),r=Math.min(...e.map(a=>a.y)),g=Math.max(...e.map(a=>a.y)),d=[];let u=0;for(;u<t;){const a=new l(z(o,n,Math.random()),z(g,r,Math.random()));let m=!0;for(const c of s)if(c.containsPoint(a)||c.distanceToPoint(a)<this.treeSize/2){m=!1;break}if(m){for(const c of d)if(!(!c||!a||a.x===void 0||a.y===void 0)&&b(c.center,a)<this.treeSize){m=!1;break}}if(m){let c=!1;for(const ht of s)if(ht.distanceToPoint(a)<this.treeSize*2){c=!0;break}m=c}m&&(d.push(new wt(a,this.treeSize)),u=0),u++}return console.log(d),d},ot=function(){const t=[];for(const n of this.graph.segments)t.push(new q(n,this.roadWidth+this.buildingWidth+this.spacing*2,this.roadRoundness));const e=x.union(t.map(n=>n.poly));for(let n=0;n<e.length;n++)e[n].lenght()<this.buildingMinLenght&&(e.splice(n,1),n--);const s=[];for(const n of e){const r=n.lenght(),g=Math.floor(r/(this.buildingMinLenght+this.spacing));if(g<=0)continue;const d=(r-this.spacing*(g-1))/g,u=n.directionVector();let a=n.p1;for(let m=0;m<g;m++){const c=P(a,E(u,d));s.push(new v(a,c)),a=P(c,E(u,this.spacing))}}const o=[];for(const n of s)o.push(new q(n,this.buildingWidth).poly);for(let n=0;n<o.length;n++)for(let r=n+1;r<o.length;r++)o[n].intersectsPolygon(o[r])&&(o.splice(r,1),r--);return o.map(n=>new mt(n))};const W=document.getElementById("myCanvas");W.width=600;W.height=600;const V=W.getContext("2d"),j=[new l(50,80),new l(20,500),new l(500,200)],yt=[new v(j[0],j[1])],X=localStorage.getItem("graph"),_=X?JSON.parse(X):null,y=_?T.load(_):new T(j,yt),N=new pt(W),R=new ft(N,y),Y=new vt(y);let H=y.hash();rt();function rt(){N.reset(),y.hash()!==H&&(Y.generate(),H=y.hash()),Y.draw(V),V.globalAlpha=.3,R.display(),requestAnimationFrame(rt)}function bt(){localStorage.setItem("graph",JSON.stringify(y))}function Mt(){R.dispose()}window.graph=y;window.graphEditor=R;window.viewPort=N;window.save=bt;window.dispose=Mt;
