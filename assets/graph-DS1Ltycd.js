var et=Object.defineProperty;var B=i=>{throw TypeError(i)};var st=(i,t,e)=>t in i?et(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>st(i,typeof t!="symbol"?t+"":t,e),it=(i,t,e)=>t.has(i)||B("Cannot "+e);var v=(i,t,e)=>t.has(i)?B("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e);var l=(i,t,e)=>(it(i,t,"access private method"),e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */class a{constructor(t,e){this.x=t,this.y=e}draw(t,{size:e=18,color:s="black",outline:n=!1,fill:o=!1}={}){const h=e/2;t.beginPath(),t.fillStyle=s,t.arc(this.x,this.y,h,0,Math.PI*2),t.fill(),n&&(t.save(),t.beginPath(),t.lineWidth=2,t.strokeStyle="yellow",t.arc(this.x,this.y,h*.6,0,Math.PI*2),t.stroke(),t.restore()),o&&(t.save(),t.beginPath(),t.fillStyle="yellow",t.arc(this.x,this.y,h*.4,0,Math.PI*2),t.fill(),t.restore())}equals(t){return this.x===t.x&&this.y===t.y}}function z(i,t,e=Number.MAX_SAFE_INTEGER){let s=Number.MAX_SAFE_INTEGER,n=null;for(const o of t){const h=J(o,i);h<s&&h<e&&(s=h,n=o)}return n}function nt(i,t){return new a((i.x+t.x)/2,(i.y+t.y)/2)}function J(i,t){return Math.hypot(i.x-t.x,i.y-t.y)}function ot(i,t){return new a(i.x*t,i.y*t)}function R(i,t){return new a(i.x+t.x,i.y+t.y)}function E(i,t){return new a(i.x-t.x,i.y-t.y)}function ht(i){return Math.atan2(i.y,i.x)}function N(i,t,e){return new a(i.x+Math.cos(t)*e,i.y+Math.sin(t)*e)}function O(i,t,e,s){const n=(s.x-e.x)*(i.y-e.y)-(s.y-e.y)*(i.x-e.x),o=(e.y-i.y)*(i.x-t.x)-(e.x-i.x)*(i.y-t.y),h=(s.y-e.y)*(t.x-i.x)-(s.x-e.x)*(t.y-i.y);if(h!=0){const d=n/h,c=o/h;if(d>=0&&d<=1&&c>=0&&c<=1)return{x:T(i.x,t.x,d),y:T(i.y,t.y,d),offset:d}}return null}function T(i,t,e){return i+(t-i)*e}class m{constructor(t,e){this.p1=t,this.p2=e}draw(t,{width:e=4,color:s="white",dash:n=[0,0]}={}){t.beginPath(),t.strokeStyle=s,t.setLineDash(n),t.moveTo(this.p1.x,this.p1.y),t.lineTo(this.p2.x,this.p2.y),t.stroke(),t.setLineDash([])}lenght(){return J(this.p1,this.p2)}equals(t){return this.includes(t.p1)&&this.includes(t.p2)}includes(t){return this.p1.equals(t)||this.p2.equals(t)}}var u,Y,K,U,k,V;class rt{constructor(t,e){v(this,u);r(this,"ctx");r(this,"selected");r(this,"hovered");r(this,"dragging");r(this,"viewport");r(this,"graph");r(this,"mouse");this.viewport=t,this.graph=e,this.ctx=this.viewport.ctx,this.selected=null,this.hovered=null,this.dragging=!1,l(this,u,Y).call(this)}dispose(){this.graph.dispose(),this.selected=null,this.hovered=null}display(){var t;if(this.graph.draw(this.ctx),(t=this.hovered)==null||t.draw(this.ctx,{fill:!0}),this.selected){const e=this.hovered?this.hovered:this.mouse;new m(this.selected,e).draw(this.ctx,{dash:[3,3]}),this.selected.draw(this.ctx,{outline:!0})}}}u=new WeakSet,Y=function(){this.viewport.canvas.addEventListener("mousedown",l(this,u,U).bind(this)),this.viewport.canvas.addEventListener("mousemove",l(this,u,K).bind(this)),this.viewport.canvas.addEventListener("mouseup",()=>this.dragging=!1)},K=function(t){this.mouse=this.viewport.getMouse(t),this.hovered=z(this.mouse,this.graph.points,10),this.dragging===!0&&(this.selected.x=this.mouse.x,this.selected.y=this.mouse.y)},U=function(t){if(t.button===2){this.hovered?l(this,u,V).call(this,this.hovered):this.hovered||(this.selected=null);return}if(t.button===0){if(this.viewport.drag.active===!0)return;if(this.mouse=this.viewport.getMouse(t),this.hovered=z(this.mouse,this.graph.points,10),this.hovered){l(this,u,k).call(this,this.hovered),this.dragging=!0;return}this.graph.addPoint(this.mouse),l(this,u,k).call(this,this.mouse);return}if(this.hovered){this.selected=this.hovered;return}},k=function(t){this.selected&&this.graph.tryAddSegment(this.selected,t),this.selected=t},V=function(t){this.graph.removePoint(t),this.selected=null,this.hovered=null};class y{constructor(t,e){this.points=t,this.segments=e}draw(t){for(const e of this.points)e.draw(t);for(const e of this.segments)e.draw(t)}dispose(){this.points.length=0,this.segments.length=0}getSegmentWithPoint(t){const e=[];for(const s of this.segments)s.includes(t)&&e.push(s);return e}addPoint(t){return this.points.push(t),!0}removePoint(t){const e=this.getSegmentWithPoint(t);if(!this.containsPoint(t))return!1;for(const s of e)this.removeSegment(s);return this.points.splice(this.points.indexOf(t),1),!0}containsPoint(t){return this.points.find(e=>e.equals(t))}addSegment(t){return this.segments.push(t),!0}removeSegment(t){return this.segments.splice(this.segments.indexOf(t),1),!0}containsSegment(t){return this.segments.find(e=>e.equals(t))}tryAddSegment(t,e){const s=new m(t,e);return this.containsSegment(s)||t.equals(e)?!1:this.addSegment(s)}tryRemoveSegment(t){return!this.containsSegment(t)||t.p1.equals(t.p2)?!1:this.removeSegment(t)}static load(t){const e=t.points.map(n=>new a(n.x,n.y)),s=t.segments.map(n=>new m(e.find(o=>o.equals(n.p1)),e.find(o=>o.equals(n.p2))));return new y(e,s)}}var g,A,D,H,Q,Z;class at{constructor(t){v(this,g);r(this,"ctx");r(this,"canvas");r(this,"zoom",1);r(this,"center");r(this,"offset");r(this,"drag");this.canvas=t,this.ctx=t.getContext("2d"),this.center=new a(0,0),this.offset=ot(this.center,-1),this.drag={start:new a(0,0),end:new a(0,0),offset:new a(0,0),active:!1},l(this,g,A).call(this)}reset(){this.ctx.restore(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.center.x,this.center.y),this.ctx.scale(1/this.zoom,1/this.zoom);const t=this.getOffset();this.ctx.translate(t.x,t.y)}getMouse(t,e=!1){const s=new a((t.offsetX-this.center.x)*this.zoom-this.offset.x,(t.offsetY-this.center.y)*this.zoom-this.offset.y);return e?E(s,this.drag.offset):s}getOffset(){return R(this.offset,this.drag.offset)}}g=new WeakSet,A=function(){this.canvas.addEventListener("mousewheel",l(this,g,D).bind(this)),this.canvas.addEventListener("mousedown",l(this,g,H).bind(this)),this.canvas.addEventListener("mousemove",l(this,g,Q).bind(this)),this.canvas.addEventListener("mouseup",l(this,g,Z).bind(this))},D=function(t){t.preventDefault(),t.stopPropagation();const e=Math.sign(t.deltaY),s=.1;this.zoom+=e*s,this.zoom=Math.max(1,Math.min(5,this.zoom))},H=function(t){t.button===0&&t.ctrlKey===!0&&(this.drag.start=this.getMouse(t),this.drag.active=!0)},Q=function(t){this.drag.active&&(this.drag.end=this.getMouse(t),this.drag.offset=E(this.drag.end,this.drag.start))},Z=function(t){this.drag.active&&(this.offset=R(this.offset,this.drag.offset),this.drag={start:new a(0,0),end:new a(0,0),offset:new a(0,0),active:!1})};class w{constructor(t){r(this,"points");r(this,"segments");this.points=t,this.segments=new Array(t.length/2);for(let e=1;e<=t.length;e++)this.segments.push(new m(t[e-1],this.points[e%t.length]))}static union(t){w.multiBreak(t);const e=[];for(let s=0;s<t.length;s++)for(const n of t[s].segments){let o=!0;for(let h=0;h<t.length;h++)if(s!=h&&t[h].containsSegment(n)){o=!1;break}o&&n!==void 0&&e.push(n)}return e}static multiBreak(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++)w.break(t[e],t[s])}static break(t,e){const s=t.segments,n=e.segments;for(let o=0;o<s.length;o++)for(let h=0;h<n.length;h++){if(!s[o]||!n[h])continue;const d=O(s[o].p1,s[o].p2,n[h].p1,n[h].p2);if(d&&d.offset!=1&&d.offset!=0){const c=new a(d.x,d.y);let f=s[o].p2;s[o].p2=c,s.splice(o+1,0,new m(c,f)),f=n[h].p2,n[h].p2=c,n.splice(h+1,0,new m(c,f))}}}containsSegment(t){if(!t)return!1;const e=nt(t.p1,t.p2);return this.containsPoint(e)}containsPoint(t){const e=new a(-1e3,-1e3);let s=0;for(const n of this.segments){if(!n)continue;O(e,t,n.p1,n.p2)&&s++}return s%2==1}draw(t,{stroke:e="blue",lineWidth:s=2,fill:n="rgba(0, 0, 255, 0.3)"}={}){if(this.points.length!==0){t.beginPath(),t.fillStyle=n,t.strokeStyle=e,t.lineWidth=s,t.moveTo(this.points[0].x,this.points[0].y);for(let o=1;o<this.points.length;o++)t.lineTo(this.points[o].x,this.points[o].y);t.closePath(),t.fill(),t.stroke()}}}var b,$;class j{constructor(t,e,s=1){v(this,b);r(this,"skeleton");r(this,"poly");t!==void 0&&(this.skeleton=t,this.poly=l(this,b,$).call(this,e,s))}draw(t,e={}){var s;((s=this.poly)==null?void 0:s.points.length)===0||this.skeleton===void 0||this.poly.draw(t,e)}}b=new WeakSet,$=function(t,e){const{p1:s,p2:n}=this.skeleton,o=t/2,h=ht(E(s,n)),d=h+Math.PI/2,c=h-Math.PI/2,f=[],P=Math.PI/Math.max(1,e),q=P/2;for(let p=c;p<=d+q;p+=P)f.push(N(s,p,o));for(let p=c;p<=d+q;p+=P)f.push(N(n,Math.PI+p,o));return new w(f)};var x,C;class dt{constructor(t,e=100,s=10,n=15,o=50,h=15){v(this,x);r(this,"graph");r(this,"roadRoundness");r(this,"roadWidth");r(this,"envelopes");r(this,"buildings");r(this,"roadBoarders");r(this,"buildingWidth");r(this,"spacing");r(this,"buildingMinLenght");this.graph=t,this.roadWidth=e,this.roadRoundness=s,this.envelopes=new Array(this.graph.segments.length),this.roadBoarders=[],this.buildingWidth=n,this.spacing=o,this.buildingMinLenght=h,this.generate()}generate(){this.envelopes.length=0;for(const t of this.graph.segments)this.envelopes.push(new j(t,this.roadWidth,this.roadRoundness));this.roadBoarders=w.union(this.envelopes.map(t=>t.poly)),this.buildings=l(this,x,C).call(this)}draw(t){for(const e of this.envelopes)e.draw(t,{fill:"#BBB",stroke:"#BBB",lineWidth:5});for(const e of this.graph.segments)e.draw(t,{color:"white",width:4,dash:[10,10]});for(const e of this.roadBoarders)e.draw(t,{color:"white",width:4});for(const e of this.buildings)e.draw(t)}}x=new WeakSet,C=function(){const t=[];for(const s of this.graph.segments)t.push(new j(s,this.roadWidth+this.buildingWidth+this.spacing*2,this.roadRoundness));const e=w.union(t.map(s=>s.poly));for(let s=0;s<e.length;s++)e[s].lenght()<this.buildingMinLenght&&(e.splice(s,1),s--);return e};const M=document.getElementById("myCanvas");M.width=600;M.height=600;const F=M.getContext("2d"),I=[new a(50,80),new a(20,500),new a(500,200)],lt=[new m(I[0],I[1])],G=localStorage.getItem("graph"),X=G?JSON.parse(G):null,S=X?y.load(X):new y(I,lt),L=new at(M),W=new rt(L,S),_=new dt(S);tt();function tt(){L.reset(),_.generate(),_.draw(F),F.globalAlpha=.3,W.display(),requestAnimationFrame(tt)}function ut(){localStorage.setItem("graph",JSON.stringify(S))}function gt(){W.dispose()}window.graph=S;window.graphEditor=W;window.viewPort=L;window.save=ut;window.dispose=gt;
